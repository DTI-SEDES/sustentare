<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programa Sustentare - Sistema de Monitoramento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --verde-primario: #2E7D32;
            --verde-secundario: #4CAF50;
            --verde-claro: #C8E6C9;
            --verde-escuro: #1B5E20;
            --branco: #FFFFFF;
            --cinza-claro: #F5F5F5;
        }
        
        body {
            background-color: var(--cinza-claro);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--verde-primario), var(--verde-secundario));
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .logo-container {
            background-color: var(--branco);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            color: var(--verde-primario);
            font-size: 0.8rem;
            text-align: center;
            padding: 5px;
        }
        
        .page-title {
            color: var(--verde-escuro);
            border-bottom: 2px solid var(--verde-claro);
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--verde-primario), var(--verde-secundario));
            color: white;
            font-weight: bold;
            border-radius: 10px 10px 0 0 !important;
        }
        
        .filter-section {
            background-color: var(--verde-claro);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table th {
            background-color: var(--verde-primario);
            color: white;
        }
        
        .map-container {
            position: relative;
            height: 500px;
            background-color: #e9f5e9;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .rs-map {
            width: 100%;
            height: 100%;
        }
        
        .city-marker {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: var(--verde-primario);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .city-marker:hover {
            transform: translate(-50%, -50%) scale(1.5);
            background-color: var(--verde-escuro);
        }
        
        .city-marker.high {
            background-color: #4CAF50;
            width: 16px;
            height: 16px;
        }
        
        .city-marker.medium {
            background-color: #8BC34A;
            width: 14px;
            height: 14px;
        }
        
        .city-marker.low {
            background-color: #CDDC39;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .search-result-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .search-result-item:hover {
            background-color: var(--verde-claro);
        }
        
        .city-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 15px;
        }
        
        .progress {
            height: 10px;
            margin-top: 5px;
        }
        
        .region-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .region-btn {
            padding: 8px 16px;
            border: 2px solid var(--verde-secundario);
            background: white;
            color: var(--verde-secundario);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .region-btn.active {
            background: var(--verde-secundario);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <div class="d-flex align-items-center">
                <div class="logo-container">
                    SUSTENTARE
                </div>
                <a class="navbar-brand" href="#">
                    <strong>PROGRAMA SUSTENTARE</strong><br>
                    <small>Monitoramento de Cidades Recebedoras</small>
                </a>
            </div>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-calendar-alt me-2"></i>
                    <span id="current-date"></span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Filtros -->
        <div class="filter-section">
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label"><strong>Pesquisar Cidade</strong></label>
                    <div class="search-box">
                        <input type="text" class="form-control" id="city-search" placeholder="Digite o nome da cidade...">
                        <div class="search-results" id="search-results"></div>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label"><strong>Região</strong></label>
                    <div class="region-selector">
                        <div class="region-btn active" data-region="all">Todas as Regiões</div>
                        <div class="region-btn" data-region="metropolitana">Metropolitana</div>
                        <div class="region-btn" data-region="norte">Norte</div>
                        <div class="region-btn" data-region="sul">Sul</div>
                        <div class="region-btn" data-region="leste">Leste</div>
                        <div class="region-btn" data-region="oeste">Oeste</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mapa e Lista -->
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-map-marked-alt me-2"></i>Distribuição por Cidades - Rio Grande do Sul
                    </div>
                    <div class="card-body">
                        <div class="map-container">
                            <!-- Mapa do RS será renderizado via JavaScript -->
                            <div class="rs-map" id="rs-map">
                                <!-- Marcadores de cidades serão adicionados via JavaScript -->
                            </div>
                            
                            <div class="legend">
                                <div class="legend-item">
                                    <div class="legend-color high"></div>
                                    <span>Alto percentual</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color medium"></div>
                                    <span>Médio percentual</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color low"></div>
                                    <span>Baixo percentual</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="city-info" id="city-info" style="display: none;">
                            <h5 id="city-name"></h5>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <strong>Percentual de Recebimento:</strong>
                                    <div class="progress">
                                        <div class="progress-bar" id="city-percent-bar" role="progressbar"></div>
                                    </div>
                                    <span id="city-percent-text"></span>
                                </div>
                                <div class="col-md-6">
                                    <strong>Região:</strong> <span id="city-region"></span><br>
                                    <strong>Status:</strong> <span id="city-status"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-list me-2"></i>Lista de Cidades Recebedoras
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Cidade</th>
                                        <th>Região</th>
                                        <th>Percentual</th>
                                    </tr>
                                </thead>
                                <tbody id="cities-table">
                                    <!-- Dados serão preenchidos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <i class="fas fa-chart-pie me-2"></i>Distribuição por Região
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="regionChart" height="250"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-light mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <h6>Programa Sustentare - Sistema de Monitoramento</h6>
                    <p class="mb-0">Monitoramento de cidades recebedoras no Rio Grande do Sul</p>
                </div>
                <div class="col-md-4 text-end">
                    <p class="mb-0">Última atualização: <span id="last-update"></span></p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Dados das cidades do Rio Grande do Sul
        const citiesData = [
            { name: "Porto Alegre", region: "metropolitana", percent: 18.5, x: 65, y: 75 },
            { name: "Caxias do Sul", region: "norte", percent: 12.2, x: 75, y: 45 },
            { name: "Pelotas", region: "sul", percent: 9.8, x: 50, y: 90 },
            { name: "Canoas", region: "metropolitana", percent: 8.7, x: 60, y: 70 },
            { name: "Santa Maria", region: "central", percent: 7.5, x: 40, y: 60 },
            { name: "Gravataí", region: "metropolitana", percent: 6.9, x: 65, y: 68 },
            { name: "Viamão", region: "metropolitana", percent: 5.8, x: 68, y: 72 },
            { name: "Novo Hamburgo", region: "metropolitana", percent: 5.2, x: 70, y: 65 },
            { name: "São Leopoldo", region: "metropolitana", percent: 4.8, x: 68, y: 67 },
            { name: "Rio Grande", region: "sul", percent: 4.5, x: 45, y: 95 },
            { name: "Alvorada", region: "metropolitana", percent: 3.9, x: 63, y: 70 },
            { name: "Passo Fundo", region: "norte", percent: 3.5, x: 55, y: 35 },
            { name: "Sapucaia do Sul", region: "metropolitana", percent: 3.2, x: 67, y: 68 },
            { name: "Uruguaiana", region: "oeste", percent: 2.8, x: 20, y: 50 },
            { name: "Santa Cruz do Sul", region: "central", percent: 2.5, x: 55, y: 55 },
            { name: "Cachoeirinha", region: "metropolitana", percent: 2.3, x: 64, y: 69 },
            { name: "Bagé", region: "sul", percent: 2.1, x: 35, y: 85 },
            { name: "Bento Gonçalves", region: "norte", percent: 1.9, x: 78, y: 48 },
            { name: "Erechim", region: "norte", percent: 1.7, x: 65, y: 30 },
            { name: "Guaíba", region: "metropolitana", percent: 1.5, x: 62, y: 72 }
        ];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            updateDate();
            renderMap();
            loadCitiesTable();
            initializeRegionChart();
            setupEventListeners();
        });

        function updateDate() {
            const now = new Date();
            document.getElementById('current-date').textContent = 
                now.toLocaleDateString('pt-BR');
            document.getElementById('last-update').textContent = 
                now.toLocaleDateString('pt-BR');
        }

        function renderMap() {
            const mapContainer = document.getElementById('rs-map');
            
            // Limpa marcadores existentes
            const existingMarkers = document.querySelectorAll('.city-marker');
            existingMarkers.forEach(marker => marker.remove());
            
            // Adiciona marcadores para cada cidade
            citiesData.forEach(city => {
                const marker = document.createElement('div');
                marker.className = `city-marker ${getPercentClass(city.percent)}`;
                marker.style.left = `${city.x}%`;
                marker.style.top = `${city.y}%`;
                marker.setAttribute('data-city', city.name);
                marker.setAttribute('title', `${city.name} - ${city.percent}%`);
                
                marker.addEventListener('click', function() {
                    showCityInfo(city);
                });
                
                mapContainer.appendChild(marker);
            });
        }

        function getPercentClass(percent) {
            if (percent >= 10) return 'high';
            if (percent >= 5) return 'medium';
            return 'low';
        }

        function showCityInfo(city) {
            document.getElementById('city-info').style.display = 'block';
            document.getElementById('city-name').textContent = city.name;
            document.getElementById('city-percent-bar').style.width = `${city.percent}%`;
            document.getElementById('city-percent-text').textContent = `${city.percent}%`;
            document.getElementById('city-region').textContent = getRegionName(city.region);
            document.getElementById('city-status').textContent = getStatusByPercent(city.percent);
            
            // Atualiza a cor da barra de progresso
            const percentBar = document.getElementById('city-percent-bar');
            percentBar.className = 'progress-bar';
            if (city.percent >= 10) {
                percentBar.classList.add('bg-success');
            } else if (city.percent >= 5) {
                percentBar.classList.add('bg-warning');
            } else {
                percentBar.classList.add('bg-info');
            }
        }

        function getRegionName(region) {
            const regions = {
                'metropolitana': 'Metropolitana',
                'norte': 'Norte',
                'sul': 'Sul',
                'leste': 'Leste',
                'oeste': 'Oeste',
                'central': 'Central'
            };
            return regions[region] || region;
        }

        function getStatusByPercent(percent) {
            if (percent >= 10) return 'Alto recebimento';
            if (percent >= 5) return 'Médio recebimento';
            return 'Baixo recebimento';
        }

        function loadCitiesTable() {
            const table = document.getElementById('cities-table');
            table.innerHTML = '';
            
            // Ordena cidades por percentual (maior para menor)
            const sortedCities = [...citiesData].sort((a, b) => b.percent - a.percent);
            
            sortedCities.forEach(city => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${city.name}</td>
                    <td>${getRegionName(city.region)}</td>
                    <td>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar ${getPercentClass(city.percent)}" 
                                 style="width: ${city.percent}%"></div>
                        </div>
                        <small>${city.percent}%</small>
                    </td>
                `;
                
                row.addEventListener('click', function() {
                    showCityInfo(city);
                });
                
                table.appendChild(row);
            });
        }

        function initializeRegionChart() {
            const ctx = document.getElementById('regionChart').getContext('2d');
            
            // Calcula totais por região
            const regionTotals = {};
            citiesData.forEach(city => {
                if (!regionTotals[city.region]) {
                    regionTotals[city.region] = 0;
                }
                regionTotals[city.region] += city.percent;
            });
            
            const regions = Object.keys(regionTotals);
            const data = Object.values(regionTotals);
            
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: regions.map(region => getRegionName(region)),
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#4CAF50',
                            '#2196F3',
                            '#FF9800',
                            '#9C27B0',
                            '#F44336',
                            '#00BCD4'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed.toFixed(1)}% (${percentage}% do total)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function setupEventListeners() {
            // Pesquisa de cidades
            document.getElementById('city-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const resultsContainer = document.getElementById('search-results');
                
                if (searchTerm.length < 2) {
                    resultsContainer.style.display = 'none';
                    return;
                }
                
                const filteredCities = citiesData.filter(city => 
                    city.name.toLowerCase().includes(searchTerm)
                );
                
                if (filteredCities.length > 0) {
                    resultsContainer.innerHTML = '';
                    filteredCities.forEach(city => {
                        const item = document.createElement('div');
                        item.className = 'search-result-item';
                        item.textContent = `${city.name} - ${getRegionName(city.region)} (${city.percent}%)`;
                        item.addEventListener('click', function() {
                            document.getElementById('city-search').value = city.name;
                            resultsContainer.style.display = 'none';
                            showCityInfo(city);
                        });
                        resultsContainer.appendChild(item);
                    });
                    resultsContainer.style.display = 'block';
                } else {
                    resultsContainer.style.display = 'none';
                }
            });
            
            // Fecha resultados ao clicar fora
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-box')) {
                    document.getElementById('search-results').style.display = 'none';
                }
            });
            
            // Filtros por região
            document.querySelectorAll('.region-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.region-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const region = this.getAttribute('data-region');
                    filterByRegion(region);
                });
            });
        }

        function filterByRegion(region) {
            const tableRows = document.querySelectorAll('#cities-table tr');
            const markers = document.querySelectorAll('.city-marker');
            
            if (region === 'all') {
                // Mostra todas as cidades
                tableRows.forEach(row => row.style.display = '');
                markers.forEach(marker => marker.style.display = 'block');
            } else {
                // Filtra por região
                tableRows.forEach(row => {
                    const cityName = row.cells[0].textContent;
                    const city = citiesData.find(c => c.name === cityName);
                    if (city && city.region === region) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
                
                markers.forEach(marker => {
                    const cityName = marker.getAttribute('data-city');
                    const city = citiesData.find(c => c.name === cityName);
                    if (city && city.region === region) {
                        marker.style.display = 'block';
                    } else {
                        marker.style.display = 'none';
                    }
                });
            }
        }
    </script>
</body>
</html>
